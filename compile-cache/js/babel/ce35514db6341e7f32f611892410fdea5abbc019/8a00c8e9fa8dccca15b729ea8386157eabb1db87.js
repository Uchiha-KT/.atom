'use babel';

var __hasProp = ({}).hasOwnProperty,
    __extends = function __extends(child, parent) {
  for (var key in parent) {
    if (__hasProp.call(parent, key)) child[key] = parent[key];
  }function ctor() {
    this.constructor = child;
  }ctor.prototype = parent.prototype;child.prototype = new ctor();child.__super__ = parent.prototype;return child;
},
    $ = require('atom-space-pen-views').$,
    DirectoryView = require('./directory-view'),
    ScrollView = require('atom-space-pen-views').ScrollView,
    getObject = require('../helpers').getObject;

var hideLocalTreeError = false;

function hideLocalTree() {
  var treeView = getObject({
    obj: atom.packages.loadedPackages,
    keys: ['tree-view', 'mainModule', 'treeView']
  });

  if (treeView && typeof treeView.detach === 'function') {
    // Fix for Issue 433 ( workaround to stop throwing error)
    try {
      treeView.detach();
    } catch (e) {
      if (hideLocalTreeError === false) {
        atom.notifications.addWarning('Remote FTP: See issue #433', {
          dismissable: false
        });
        hideLocalTreeError = true;
      }
    }
  }
}

function showLocalTree() {
  var treeView = getObject({
    obj: atom.packages.loadedPackages,
    keys: ['tree-view', 'mainModule', 'treeView']
  });
  if (treeView && typeof treeView.detach === 'function') treeView.attach();
}

module.exports = TreeView = (function (parent) {
  __extends(TreeView, parent);

  var resizeCursor = process.platform === 'win32' ? 'ew-resize' : 'col-resize';

  function TreeView() {
    TreeView.__super__.constructor.apply(this, arguments);
  }

  TreeView.content = function () {
    var _this = this;

    return this.div({
      'class': 'remote-ftp-view ftptree-view-resizer tool-panel',
      'data-show-on-right-side': atom.config.get('tree-view.showOnRightSide')
    }, function () {
      _this.div({
        'class': 'scroller',
        outlet: 'scroller'
      }, function () {
        _this.ol({
          'class': 'ftptree-view full-menu list-tree has-collapsable-children focusable-panel',
          tabindex: -1,
          outlet: 'list'
        });
      });
      _this.div({
        'class': 'resize-handle',
        outlet: 'horizontalResize',
        style: 'cursor:' + resizeCursor });
      // platform specific cursor
      _this.div({
        'class': 'queue tool-panel panel-bottom',
        tabindex: -1,
        outlet: 'queue'
      }, function () {
        _this.ul({
          'class': 'progress tool-panel panel-top',
          tabindex: -1,
          outlet: 'progress'
        });
        _this.ul({
          'class': 'list',
          tabindex: -1,
          outlet: 'debug'
        });
        return _this.div({
          'class': 'resize-handle',
          outlet: 'verticalResize'
        });
      });
      _this.div({
        'class': 'offline',
        tabindex: -1,
        outlet: 'offline'
      });
    });
  };

  var elapsedTime = function elapsedTime(ms) {
    var days = Math.floor(ms / 86400000);
    ms %= 86400000;
    var hours = Math.floor(ms / 3600000);
    ms %= 3600000;
    var mins = Math.floor(ms / 60000);
    ms %= 60000;
    var secs = Math.floor(ms / 1000);
    ms %= 1000;

    return ((days ? days + 'd ' : '') + (hours ? (days && hours < 10 ? '0' : '') + hours + 'h ' : '') + (mins ? ((days || hours) && mins < 10 ? '0' : '') + mins + 'm ' : '') + (secs ? ((days || hours || mins) && secs < 10 ? '0' : '') + secs + 's ' : '')).replace(/^[dhms]\s+/, '').replace(/[dhms]\s+[dhms]/g, '').replace(/^\s+/, '').replace(/\s+$/, '') || '0s';
  };

  TreeView.prototype.initialize = function (state) {
    TreeView.__super__.initialize.apply(this, arguments);

    var self = this;

    // self.addClass(atom.config.get('tree-view.showOnRightSide') ? 'panel-right' : 'panel-left');
    var html = '<ul>';
    html += '<li><a role="connect" class="btn btn-default icon">Connect</a><br /></li>';
    html += '<li><a role="configure" class="btn btn-default icon">Edit Configuration</a><br /></li>';
    html += '<li><a role="configure_ignored" class="btn btn-default icon">Edit Ignore Configuration</a><br /></li>';
    html += '<li><a role="toggle" class="btn btn-default icon">Close Panel</a></li>';
    html += '</ul>';
    self.offline.html(html);
    if (atom.project.remoteftp.isConnected()) {
      self.showOnline();
    } else {
      self.showOffline();
    }

    self.root = new DirectoryView(atom.project.remoteftp.root);
    self.root.expand();
    self.list.append(self.root);

    // self.attach();

    // Events
    atom.config.onDidChange('tree-view.showOnRightSide', function () {
      if (self.isVisible()) {
        setTimeout(function () {
          self.detach();
          self.attach();
        }, 1);
      }
    });
    atom.config.onDidChange('Remote-FTP.hideLocalWhenDisplayed', function (values) {
      if (values.newValue) {
        if (self.isVisible()) {
          hideLocalTree();
        }
      } else if (self.isVisible()) {
        self.detach();
        showLocalTree();
        self.attach();
      } else {
        showLocalTree();
      }
    });

    atom.project.remoteftp.on('debug', function (msg) {
      self.debug.prepend('<li>' + msg + '</li>');
      var children = self.debug.children();
      if (children.length > 20) {
        children.last().remove();
      }
    });
    atom.project.remoteftp.on('queue-changed', function () {
      self.progress.empty();

      var queue = [];
      if (atom.project.remoteftp._current) {
        queue.push(atom.project.remoteftp._current);
      }
      for (var i = 0, l = atom.project.remoteftp._queue.length; i < l; ++i) {
        queue.push(atom.project.remoteftp._queue[i]);
      }

      if (queue.length === 0) {
        self.progress.hide();
      } else {
        self.progress.show();

        queue.forEach(function (queue) {
          var $li = $('<li><progress class="inline-block" /><div class="name">' + queue[0] + '</div><div class="eta">-</div></li>'),
              $progress = $li.children('progress'),
              $eta = $li.children('.eta'),
              progress = queue[2];
          self.progress.append($li);

          progress.on('progress', function (percent) {
            if (percent == -1) {
              $progress.removeAttr('max').removeAttr('value');
              $eta.text('-');
            } else {
              $progress.attr('max', 100).attr('value', parseInt(percent * 100, 10));
              var eta = progress.getEta();
              $eta.text(elapsedTime(eta));
            }
          });
          progress.once('done', function () {
            progress.removeAllListeners('progress');
          });
        });
      }
    });

    self.offline.on('click', '[role="connect"]', function (e) {
      atom.project.remoteftp.readConfig(function () {
        atom.project.remoteftp.connect();
      });
    });
    self.offline.on('click', '[role="configure"]', function (e) {
      atom.workspace.open(atom.project.remoteftp.getConfigPath());
    });
    self.offline.on('click', '[role="configure_ignored"]', function (e) {
      atom.workspace.open(atom.project.getDirectories()[0].resolve('.ftpignore'));
    });
    self.offline.on('click', '[role="toggle"]', function (e) {
      self.toggle();
    });
    self.horizontalResize.on('dblclick', function (e) {
      self.resizeToFitContent(e);
    });
    self.horizontalResize.on('mousedown', function (e) {
      self.resizeHorizontalStarted(e);
    });
    self.verticalResize.on('mousedown', function (e) {
      self.resizeVerticalStarted(e);
    });
    self.list.on('keydown', function (e) {
      self.remoteKeyboardNavigation(e);
    });

    atom.project.remoteftp.on('connected', function () {
      self.showOnline();
    });
    // atom.project.remoteftp.on('closed', function () {
    atom.project.remoteftp.on('disconnected', function () {
      self.showOffline();
    });
  };

  TreeView.prototype.attach = function () {
    if (atom.config.get('tree-view.showOnRightSide')) {
      this.panel = atom.workspace.addRightPanel({ item: this });
    } else {
      this.panel = atom.workspace.addLeftPanel({ item: this });
    }

    if (atom.config.get('Remote-FTP.hideLocalWhenDisplayed')) {
      hideLocalTree();
    } else {
      showLocalTree();
    }
  };

  TreeView.prototype.detach = function () {
    TreeView.__super__.detach.apply(this, arguments);

    if (this.panel) {
      this.panel.destroy();
      this.panel = null;
    }
  };

  TreeView.prototype.toggle = function () {
    if (this.isVisible()) {
      this.detach();
    } else {
      this.attach();
    }
  };

  TreeView.prototype.showOffline = function () {
    this.list.hide();
    this.queue.hide();
    this.offline.css('display', 'flex');
  };

  TreeView.prototype.showOnline = function () {
    this.list.show();
    this.queue.show();
    this.offline.hide();
  };

  TreeView.prototype.resolve = function (path) {
    var view = $('.remote-ftp-view [data-path="' + path + '"]').map(function () {
      var v = $(this).view();
      return v || null;
    }).get(0);

    return view;
  };

  TreeView.prototype.getSelected = function () {
    var views = $('.remote-ftp-view .selected').map(function () {
      var v = $(this).view();
      return v || null;
    }).get();

    return views;
  };

  TreeView.prototype.resizeVerticalStarted = function (e) {
    e.preventDefault();

    this.resizeHeightStart = this.queue.height();
    this.resizeMouseStart = e.pageY;
    $(document).on('mousemove', this.resizeVerticalView.bind(this));
    $(document).on('mouseup', this.resizeVerticalStopped);
  };

  TreeView.prototype.resizeVerticalStopped = function () {
    delete this.resizeHeightStart;
    delete this.resizeMouseStart;
    $(document).off('mousemove', this.resizeVerticalView);
    $(document).off('mouseup', this.resizeVerticalStopped);
  };

  TreeView.prototype.resizeVerticalView = function (e) {
    if (e.which !== 1) {
      return this.resizeVerticalStopped();
    }

    var delta = e.pageY - this.resizeMouseStart,
        height = Math.max(26, this.resizeHeightStart - delta);

    this.queue.height(height);
    this.scroller.css('bottom', height + 'px');
  };

  TreeView.prototype.resizeHorizontalStarted = function (e) {
    e.preventDefault();

    this.resizeWidthStart = this.width();
    this.resizeMouseStart = e.pageX;
    $(document).on('mousemove', this.resizeHorizontalView.bind(this));
    $(document).on('mouseup', this.resizeHorizontalStopped);
  };

  TreeView.prototype.resizeHorizontalStopped = function () {
    delete this.resizeWidthStart;
    delete this.resizeMouseStart;
    $(document).off('mousemove', this.resizeHorizontalView);
    $(document).off('mouseup', this.resizeHorizontalStopped);
  };

  TreeView.prototype.resizeHorizontalView = function (e) {
    if (e.which !== 1) {
      return this.resizeHorizontalStopped();
    }

    var delta = e.pageX - this.resizeMouseStart,
        width = Math.max(50, this.resizeWidthStart + delta);

    this.width(width);
  };

  TreeView.prototype.resizeToFitContent = function (e) {
    e.preventDefault();

    this.width(1);
    this.width(this.list.outerWidth());
  };

  TreeView.prototype.remoteKeyboardNavigation = function (e) {
    var arrows = { left: 37, up: 38, right: 39, down: 40 },
        keyCode = e.keyCode || e.which;

    switch (keyCode) {
      case arrows.up:
        this.remoteKeyboardNavigationUp();
        break;
      case arrows.down:
        this.remoteKeyboardNavigationDown();
        break;
      case arrows.left:
        this.remoteKeyboardNavigationLeft();
        break;
      case arrows.right:
        this.remoteKeyboardNavigationRight();
        break;
      default:
        return;
    }

    e.preventDefault();
    e.stopPropagation();
    this.remoteKeyboardNavigationMovePage();
  };

  TreeView.prototype.remoteKeyboardNavigationUp = function () {
    var current = this.list.find('.selected'),
        next = current.prev('.entry:visible');
    if (next.length) {
      while (next.is('.expanded') && next.find('.entries .entry:visible').length) {
        next = next.find('.entries .entry:visible');
      }
    } else {
      next = current.closest('.entries').closest('.entry:visible');
    }
    if (next.length) {
      current.removeClass('selected');
      next.last().addClass('selected');
    }
  };

  TreeView.prototype.remoteKeyboardNavigationDown = function () {
    var current = this.list.find('.selected'),
        next = current.find('.entries .entry:visible');
    if (!next.length) {
      tmp = current;
      do {
        next = tmp.next('.entry:visible');
        if (!next.length) {
          tmp = tmp.closest('.entries').closest('.entry:visible');
        }
      } while (!next.length && !tmp.is('.project-root'));
    }
    if (next.length) {
      current.removeClass('selected');
      next.first().addClass('selected');
    }
  };

  TreeView.prototype.remoteKeyboardNavigationLeft = function () {
    var current = this.list.find('.selected');
    if (!current.is('.directory')) {
      next = current.closest('.directory');
      next.view().collapse();
      current.removeClass('selected');
      next.first().addClass('selected');
    } else {
      current.view().collapse();
    }
  };

  TreeView.prototype.remoteKeyboardNavigationRight = function () {
    var current = this.list.find('.selected');
    if (current.is('.directory')) {
      var view = current.view();
      view.open();
      view.expand();
    }
  };

  TreeView.prototype.remoteKeyboardNavigationMovePage = function () {
    var current = this.list.find('.selected');
    if (current.length) {
      var scrollerTop = this.scroller.scrollTop(),
          selectedTop = current.position().top;
      if (selectedTop < scrollerTop - 10) {
        this.scroller.pageUp();
      } else if (selectedTop > scrollerTop + this.scroller.height() - 10) {
        this.scroller.pageDown();
      }
    }
  };

  return TreeView;
})(ScrollView);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbGU6Ly8vQzovVXNlcnMvdWNoaWhhLy5hdG9tL3BhY2thZ2VzL1JlbW90ZS1GVFAvbGliL3ZpZXdzL3RyZWUtdmlldy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7O0FBRVosSUFBSSxTQUFTLEdBQUcsQ0FBQSxHQUFFLENBQUMsY0FBYztJQUMvQixTQUFTLEdBQUcsU0FBWixTQUFTLENBQWEsS0FBSyxFQUFFLE1BQU0sRUFBRTtBQUFFLE9BQUssSUFBTSxHQUFHLElBQUksTUFBTSxFQUFFO0FBQUUsUUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0dBQUUsQUFBQyxTQUFTLElBQUksR0FBRztBQUFFLFFBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO0dBQUUsQUFBQyxJQUFJLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsQUFBQyxLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQUFBQyxPQUFPLEtBQUssQ0FBQztDQUFFO0lBQ2xTLENBQUMsR0FBRyxPQUFPLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLGFBQWEsR0FBRyxPQUFPLENBQUMsa0JBQWtCLENBQUM7SUFDM0MsVUFBVSxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLFVBQVU7SUFDdkQsU0FBUyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxTQUFTLENBQUM7O0FBRTlDLElBQUksa0JBQWtCLEdBQUcsS0FBSyxDQUFDOztBQUUvQixTQUFTLGFBQWEsR0FBRztBQUN2QixNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUM7QUFDekIsT0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENB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RUFBRSxDQUFDO0tBQzNCO0dBQ0YsQ0FBQzs7QUFFRixVQUFRLENBQUMsU0FBUyxDQUFDLDZCQUE2QixHQUFHLFlBQVk7QUFDN0QsUUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDNUMsUUFBSSxPQUFPLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFO0FBQzVCLFVBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM1QixVQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDWixVQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7S0FDZjtHQUNGLENBQUM7O0FBRUYsVUFBUSxDQUFDLFNBQVMsQ0FBQyxnQ0FBZ0MsR0FBRyxZQUFZO0FBQ2hFLFFBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQzVDLFFBQUksT0FBTyxDQUFDLE1BQU0sRUFBRTtBQUNsQixVQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRTtVQUN6QyxXQUFXLEdBQUcsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUcsQ0FBQztBQUN2QyxVQUFJLFdBQVcsR0FBRyxXQUFXLEdBQUcsRUFBRSxFQUFFO0FBQ2xDLFlBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7T0FDeEIsTUFBTSxJQUFJLFdBQVcsR0FBRyxXQUFXLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEVBQUU7QUFDbEUsWUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztPQUMxQjtLQUNGO0dBQ0YsQ0FBQzs7QUFFRixTQUFPLFFBQVEsQ0FBQztDQUNqQixDQUFBLENBQUMsVUFBVSxDQUFDLEFBQUMsQ0FBQyIsImZpbGUiOiJmaWxlOi8vL0M6L1VzZXJzL3VjaGloYS8uYXRvbS9wYWNrYWdlcy9SZW1vdGUtRlRQL2xpYi92aWV3cy90cmVlLXZpZXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIGJhYmVsJztcblxubGV0IF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbiAoY2hpbGQsIHBhcmVudCkgeyBmb3IgKGNvbnN0IGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcbiAgJCA9IHJlcXVpcmUoJ2F0b20tc3BhY2UtcGVuLXZpZXdzJykuJCxcbiAgRGlyZWN0b3J5VmlldyA9IHJlcXVpcmUoJy4vZGlyZWN0b3J5LXZpZXcnKSxcbiAgU2Nyb2xsVmlldyA9IHJlcXVpcmUoJ2F0b20tc3BhY2UtcGVuLXZpZXdzJykuU2Nyb2xsVmlldyxcbiAgZ2V0T2JqZWN0ID0gcmVxdWlyZSgnLi4vaGVscGVycycpLmdldE9iamVjdDtcblxubGV0IGhpZGVMb2NhbFRyZWVFcnJvciA9IGZhbHNlO1xuXG5mdW5jdGlvbiBoaWRlTG9jYWxUcmVlKCkge1xuICBjb25zdCB0cmVlVmlldyA9IGdldE9iamVjdCh7XG4gICAgb2JqOiBhdG9tLnBhY2thZ2VzLmxvYWRlZFBhY2thZ2VzLFxuICAgIGtleXM6IFsndHJlZS12aWV3JywgJ21haW5Nb2R1bGUnLCAndHJlZVZpZXcnXSxcbiAgfSk7XG5cbiAgaWYgKHRyZWVWaWV3ICYmIHR5cGVvZiB0cmVlVmlldy5kZXRhY2ggPT09ICdmdW5jdGlvbicpIHsgLy8gRml4IGZvciBJc3N1ZSA0MzMgKCB3b3JrYXJvdW5kIHRvIHN0b3AgdGhyb3dpbmcgZXJyb3IpXG4gICAgdHJ5IHtcbiAgICAgIHRyZWVWaWV3LmRldGFjaCgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChoaWRlTG9jYWxUcmVlRXJyb3IgPT09IGZhbHNlKSB7XG4gICAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRXYXJuaW5nKCdSZW1vdGUgRlRQOiBTZWUgaXNzdWUgIzQzMycsIHtcbiAgICAgICAgICBkaXNtaXNzYWJsZTogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgICBoaWRlTG9jYWxUcmVlRXJyb3IgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBzaG93TG9jYWxUcmVlKCkge1xuICBjb25zdCB0cmVlVmlldyA9IGdldE9iamVjdCh7XG4gICAgb2JqOiBhdG9tLnBhY2thZ2VzLmxvYWRlZFBhY2thZ2VzLFxuICAgIGtleXM6IFsndHJlZS12aWV3JywgJ21haW5Nb2R1bGUnLCAndHJlZVZpZXcnXSxcbiAgfSk7XG4gIGlmICh0cmVlVmlldyAmJiB0eXBlb2YgdHJlZVZpZXcuZGV0YWNoID09PSAnZnVuY3Rpb24nKSB0cmVlVmlldy5hdHRhY2goKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUcmVlVmlldyA9IChmdW5jdGlvbiAocGFyZW50KSB7XG4gIF9fZXh0ZW5kcyhUcmVlVmlldywgcGFyZW50KTtcblxuICBjb25zdCByZXNpemVDdXJzb3IgPSBwcm9jZXNzLnBsYXRmb3JtID09PSAnd2luMzInID8gJ2V3LXJlc2l6ZScgOiAnY29sLXJlc2l6ZSc7XG5cbiAgZnVuY3Rpb24gVHJlZVZpZXcoKSB7XG4gICAgVHJlZVZpZXcuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBUcmVlVmlldy5jb250ZW50ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmRpdih7XG4gICAgICBjbGFzczogJ3JlbW90ZS1mdHAtdmlldyBmdHB0cmVlLXZpZXctcmVzaXplciB0b29sLXBhbmVsJyxcbiAgICAgICdkYXRhLXNob3ctb24tcmlnaHQtc2lkZSc6IGF0b20uY29uZmlnLmdldCgndHJlZS12aWV3LnNob3dPblJpZ2h0U2lkZScpLFxuICAgIH0sICgpID0+IHtcbiAgICAgIHRoaXMuZGl2KHtcbiAgICAgICAgY2xhc3M6ICdzY3JvbGxlcicsXG4gICAgICAgIG91dGxldDogJ3Njcm9sbGVyJyxcbiAgICAgIH0sICgpID0+IHtcbiAgICAgICAgdGhpcy5vbCh7XG4gICAgICAgICAgY2xhc3M6ICdmdHB0cmVlLXZpZXcgZnVsbC1tZW51IGxpc3QtdHJlZSBoYXMtY29sbGFwc2FibGUtY2hpbGRyZW4gZm9jdXNhYmxlLXBhbmVsJyxcbiAgICAgICAgICB0YWJpbmRleDogLTEsXG4gICAgICAgICAgb3V0bGV0OiAnbGlzdCcsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmRpdih7XG4gICAgICAgIGNsYXNzOiAncmVzaXplLWhhbmRsZScsXG4gICAgICAgIG91dGxldDogJ2hvcml6b250YWxSZXNpemUnLFxuICAgICAgICBzdHlsZTogYGN1cnNvcjoke3Jlc2l6ZUN1cnNvcn1gLCAvLyBwbGF0Zm9ybSBzcGVjaWZpYyBjdXJzb3JcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kaXYoe1xuICAgICAgICBjbGFzczogJ3F1ZXVlIHRvb2wtcGFuZWwgcGFuZWwtYm90dG9tJyxcbiAgICAgICAgdGFiaW5kZXg6IC0xLFxuICAgICAgICBvdXRsZXQ6ICdxdWV1ZScsXG4gICAgICB9LCAoKSA9PiB7XG4gICAgICAgIHRoaXMudWwoe1xuICAgICAgICAgIGNsYXNzOiAncHJvZ3Jlc3MgdG9vbC1wYW5lbCBwYW5lbC10b3AnLFxuICAgICAgICAgIHRhYmluZGV4OiAtMSxcbiAgICAgICAgICBvdXRsZXQ6ICdwcm9ncmVzcycsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnVsKHtcbiAgICAgICAgICBjbGFzczogJ2xpc3QnLFxuICAgICAgICAgIHRhYmluZGV4OiAtMSxcbiAgICAgICAgICBvdXRsZXQ6ICdkZWJ1ZycsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5kaXYoe1xuICAgICAgICAgIGNsYXNzOiAncmVzaXplLWhhbmRsZScsXG4gICAgICAgICAgb3V0bGV0OiAndmVydGljYWxSZXNpemUnLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kaXYoe1xuICAgICAgICBjbGFzczogJ29mZmxpbmUnLFxuICAgICAgICB0YWJpbmRleDogLTEsXG4gICAgICAgIG91dGxldDogJ29mZmxpbmUnLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgZWxhcHNlZFRpbWUgPSBmdW5jdGlvbiAobXMpIHtcbiAgICBjb25zdCBkYXlzID0gTWF0aC5mbG9vcihtcyAvIDg2NDAwMDAwKTtcbiAgICBtcyAlPSA4NjQwMDAwMDtcbiAgICBjb25zdCBob3VycyA9IE1hdGguZmxvb3IobXMgLyAzNjAwMDAwKTtcbiAgICBtcyAlPSAzNjAwMDAwO1xuICAgIGNvbnN0IG1pbnMgPSBNYXRoLmZsb29yKG1zIC8gNjAwMDApO1xuICAgIG1zICU9IDYwMDAwO1xuICAgIGNvbnN0IHNlY3MgPSBNYXRoLmZsb29yKG1zIC8gMTAwMCk7XG4gICAgbXMgJT0gMTAwMDtcblxuICAgIHJldHVybiAoKGRheXMgPyBgJHtkYXlzfWQgYCA6ICcnKSArXG5cdFx0XHRcdChob3VycyA/IGAkeygoZGF5cykgJiYgaG91cnMgPCAxMCA/ICcwJyA6ICcnKSArIGhvdXJzfWggYCA6ICcnKSArXG5cdFx0XHRcdChtaW5zID8gYCR7KChkYXlzIHx8IGhvdXJzKSAmJiBtaW5zIDwgMTAgPyAnMCcgOiAnJykgKyBtaW5zfW0gYCA6ICcnKSArXG5cdFx0XHRcdChzZWNzID8gYCR7KChkYXlzIHx8IGhvdXJzIHx8IG1pbnMpICYmIHNlY3MgPCAxMCA/ICcwJyA6ICcnKSArIHNlY3N9cyBgIDogJycpKS5yZXBsYWNlKC9eW2RobXNdXFxzKy8sICcnKS5yZXBsYWNlKC9bZGhtc11cXHMrW2RobXNdL2csICcnKS5yZXBsYWNlKC9eXFxzKy8sICcnKS5yZXBsYWNlKC9cXHMrJC8sICcnKSB8fCAnMHMnO1xuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgVHJlZVZpZXcuX19zdXBlcl9fLmluaXRpYWxpemUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblxuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuXG5cdFx0Ly8gc2VsZi5hZGRDbGFzcyhhdG9tLmNvbmZpZy5nZXQoJ3RyZWUtdmlldy5zaG93T25SaWdodFNpZGUnKSA/ICdwYW5lbC1yaWdodCcgOiAncGFuZWwtbGVmdCcpO1xuICAgIGxldCBodG1sID0gJzx1bD4nO1xuICAgIGh0bWwgKz0gJzxsaT48YSByb2xlPVwiY29ubmVjdFwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGljb25cIj5Db25uZWN0PC9hPjxiciAvPjwvbGk+JztcbiAgICBodG1sICs9ICc8bGk+PGEgcm9sZT1cImNvbmZpZ3VyZVwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0IGljb25cIj5FZGl0IENvbmZpZ3VyYXRpb248L2E+PGJyIC8+PC9saT4nO1xuICAgIGh0bWwgKz0gJzxsaT48YSByb2xlPVwiY29uZmlndXJlX2lnbm9yZWRcIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBpY29uXCI+RWRpdCBJZ25vcmUgQ29uZmlndXJhdGlvbjwvYT48YnIgLz48L2xpPic7XG4gICAgaHRtbCArPSAnPGxpPjxhIHJvbGU9XCJ0b2dnbGVcIiBjbGFzcz1cImJ0biBidG4tZGVmYXVsdCBpY29uXCI+Q2xvc2UgUGFuZWw8L2E+PC9saT4nO1xuICAgIGh0bWwgKz0gJzwvdWw+JztcbiAgICBzZWxmLm9mZmxpbmUuaHRtbChodG1sKTtcbiAgICBpZiAoYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5pc0Nvbm5lY3RlZCgpKVx0XHRcdHsgc2VsZi5zaG93T25saW5lKCk7IH0gZWxzZVx0XHRcdHsgc2VsZi5zaG93T2ZmbGluZSgpOyB9XG5cbiAgICBzZWxmLnJvb3QgPSBuZXcgRGlyZWN0b3J5VmlldyhhdG9tLnByb2plY3QucmVtb3RlZnRwLnJvb3QpO1xuICAgIHNlbGYucm9vdC5leHBhbmQoKTtcbiAgICBzZWxmLmxpc3QuYXBwZW5kKHNlbGYucm9vdCk7XG5cblx0XHQvLyBzZWxmLmF0dGFjaCgpO1xuXG5cdFx0Ly8gRXZlbnRzXG4gICAgYXRvbS5jb25maWcub25EaWRDaGFuZ2UoJ3RyZWUtdmlldy5zaG93T25SaWdodFNpZGUnLCAoKSA9PiB7XG4gICAgICBpZiAoc2VsZi5pc1Zpc2libGUoKSkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBzZWxmLmRldGFjaCgpO1xuICAgICAgICAgIHNlbGYuYXR0YWNoKCk7XG4gICAgICAgIH0sIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlKCdSZW1vdGUtRlRQLmhpZGVMb2NhbFdoZW5EaXNwbGF5ZWQnLCAodmFsdWVzKSA9PiB7XG4gICAgICBpZiAodmFsdWVzLm5ld1ZhbHVlKSB7XG4gICAgICAgIGlmIChzZWxmLmlzVmlzaWJsZSgpKSB7XG4gICAgICAgICAgaGlkZUxvY2FsVHJlZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHNlbGYuaXNWaXNpYmxlKCkpIHtcbiAgICAgICAgc2VsZi5kZXRhY2goKTtcbiAgICAgICAgc2hvd0xvY2FsVHJlZSgpO1xuICAgICAgICBzZWxmLmF0dGFjaCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2hvd0xvY2FsVHJlZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5vbignZGVidWcnLCAobXNnKSA9PiB7XG4gICAgICBzZWxmLmRlYnVnLnByZXBlbmQoYDxsaT4ke21zZ308L2xpPmApO1xuICAgICAgY29uc3QgY2hpbGRyZW4gPSBzZWxmLmRlYnVnLmNoaWxkcmVuKCk7XG4gICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMjApXHRcdFx0XHR7IGNoaWxkcmVuLmxhc3QoKS5yZW1vdmUoKTsgfVxuICAgIH0pO1xuICAgIGF0b20ucHJvamVjdC5yZW1vdGVmdHAub24oJ3F1ZXVlLWNoYW5nZWQnLCAoKSA9PiB7XG4gICAgICBzZWxmLnByb2dyZXNzLmVtcHR5KCk7XG5cbiAgICAgIGNvbnN0IHF1ZXVlID0gW107XG4gICAgICBpZiAoYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5fY3VycmVudClcdFx0XHRcdHsgcXVldWUucHVzaChhdG9tLnByb2plY3QucmVtb3RlZnRwLl9jdXJyZW50KTsgfVxuICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhdG9tLnByb2plY3QucmVtb3RlZnRwLl9xdWV1ZS5sZW5ndGg7IGkgPCBsOyArK2kpXHRcdFx0XHR7IHF1ZXVlLnB1c2goYXRvbS5wcm9qZWN0LnJlbW90ZWZ0cC5fcXVldWVbaV0pOyB9XG5cbiAgICAgIGlmIChxdWV1ZS5sZW5ndGggPT09IDApXHRcdFx0XHR7IHNlbGYucHJvZ3Jlc3MuaGlkZSgpOyB9IGVsc2Uge1xuICAgICAgICBzZWxmLnByb2dyZXNzLnNob3coKTtcblxuICAgICAgICBxdWV1ZS5mb3JFYWNoKChxdWV1ZSkgPT4ge1xuICAgICAgICAgIGxldCAkbGkgPSAkKGA8bGk+PHByb2dyZXNzIGNsYXNzPVwiaW5saW5lLWJsb2NrXCIgLz48ZGl2IGNsYXNzPVwibmFtZVwiPiR7cXVldWVbMF19PC9kaXY+PGRpdiBjbGFzcz1cImV0YVwiPi08L2Rpdj48L2xpPmApLFxuICAgICAgICAgICAgJHByb2dyZXNzID0gJGxpLmNoaWxkcmVuKCdwcm9ncmVzcycpLFxuICAgICAgICAgICAgJGV0YSA9ICRsaS5jaGlsZHJlbignLmV0YScpLFxuICAgICAgICAgICAgcHJvZ3Jlc3MgPSBxdWV1ZVsyXTtcbiAgICAgICAgICBzZWxmLnByb2dyZXNzLmFwcGVuZCgkbGkpO1xuXG4gICAgICAgICAgcHJvZ3Jlc3Mub24oJ3Byb2dyZXNzJywgKHBlcmNlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChwZXJjZW50ID09IC0xKSB7XG4gICAgICAgICAgICAgICRwcm9ncmVzcy5yZW1vdmVBdHRyKCdtYXgnKS5yZW1vdmVBdHRyKCd2YWx1ZScpO1xuICAgICAgICAgICAgICAkZXRhLnRleHQoJy0nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICRwcm9ncmVzcy5hdHRyKCdtYXgnLCAxMDApLmF0dHIoJ3ZhbHVlJywgcGFyc2VJbnQocGVyY2VudCAqIDEwMCwgMTApKTtcbiAgICAgICAgICAgICAgY29uc3QgZXRhID0gcHJvZ3Jlc3MuZ2V0RXRhKCk7XG4gICAgICAgICAgICAgICRldGEudGV4dChlbGFwc2VkVGltZShldGEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBwcm9ncmVzcy5vbmNlKCdkb25lJywgKCkgPT4ge1xuICAgICAgICAgICAgcHJvZ3Jlc3MucmVtb3ZlQWxsTGlzdGVuZXJzKCdwcm9ncmVzcycpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHNlbGYub2ZmbGluZS5vbignY2xpY2snLCAnW3JvbGU9XCJjb25uZWN0XCJdJywgKGUpID0+IHtcbiAgICAgIGF0b20ucHJvamVjdC5yZW1vdGVmdHAucmVhZENvbmZpZygoKSA9PiB7XG4gICAgICAgIGF0b20ucHJvamVjdC5yZW1vdGVmdHAuY29ubmVjdCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gICAgc2VsZi5vZmZsaW5lLm9uKCdjbGljaycsICdbcm9sZT1cImNvbmZpZ3VyZVwiXScsIChlKSA9PiB7XG4gICAgICBhdG9tLndvcmtzcGFjZS5vcGVuKGF0b20ucHJvamVjdC5yZW1vdGVmdHAuZ2V0Q29uZmlnUGF0aCgpKTtcbiAgICB9KTtcbiAgICBzZWxmLm9mZmxpbmUub24oJ2NsaWNrJywgJ1tyb2xlPVwiY29uZmlndXJlX2lnbm9yZWRcIl0nLCAoZSkgPT4ge1xuICAgICAgYXRvbS53b3Jrc3BhY2Uub3BlbihhdG9tLnByb2plY3QuZ2V0RGlyZWN0b3JpZXMoKVswXS5yZXNvbHZlKCcuZnRwaWdub3JlJykpO1xuICAgIH0pO1xuICAgIHNlbGYub2ZmbGluZS5vbignY2xpY2snLCAnW3JvbGU9XCJ0b2dnbGVcIl0nLCAoZSkgPT4ge1xuICAgICAgc2VsZi50b2dnbGUoKTtcbiAgICB9KTtcbiAgICBzZWxmLmhvcml6b250YWxSZXNpemUub24oJ2RibGNsaWNrJywgKGUpID0+IHsgc2VsZi5yZXNpemVUb0ZpdENvbnRlbnQoZSk7IH0pO1xuICAgIHNlbGYuaG9yaXpvbnRhbFJlc2l6ZS5vbignbW91c2Vkb3duJywgKGUpID0+IHsgc2VsZi5yZXNpemVIb3Jpem9udGFsU3RhcnRlZChlKTsgfSk7XG4gICAgc2VsZi52ZXJ0aWNhbFJlc2l6ZS5vbignbW91c2Vkb3duJywgKGUpID0+IHsgc2VsZi5yZXNpemVWZXJ0aWNhbFN0YXJ0ZWQoZSk7IH0pO1xuICAgIHNlbGYubGlzdC5vbigna2V5ZG93bicsIChlKSA9PiB7IHNlbGYucmVtb3RlS2V5Ym9hcmROYXZpZ2F0aW9uKGUpOyB9KTtcblxuICAgIGF0b20ucHJvamVjdC5yZW1vdGVmdHAub24oJ2Nvbm5lY3RlZCcsICgpID0+IHtcbiAgICAgIHNlbGYuc2hvd09ubGluZSgpO1xuICAgIH0pO1xuXHRcdC8vIGF0b20ucHJvamVjdC5yZW1vdGVmdHAub24oJ2Nsb3NlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBhdG9tLnByb2plY3QucmVtb3RlZnRwLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBzZWxmLnNob3dPZmZsaW5lKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLmF0dGFjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoYXRvbS5jb25maWcuZ2V0KCd0cmVlLXZpZXcuc2hvd09uUmlnaHRTaWRlJykpIHtcbiAgICAgIHRoaXMucGFuZWwgPSBhdG9tLndvcmtzcGFjZS5hZGRSaWdodFBhbmVsKHsgaXRlbTogdGhpcyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZExlZnRQYW5lbCh7IGl0ZW06IHRoaXMgfSk7XG4gICAgfVxuXG4gICAgaWYgKGF0b20uY29uZmlnLmdldCgnUmVtb3RlLUZUUC5oaWRlTG9jYWxXaGVuRGlzcGxheWVkJykpXHRcdFx0eyBoaWRlTG9jYWxUcmVlKCk7IH0gZWxzZVx0XHRcdHsgc2hvd0xvY2FsVHJlZSgpOyB9XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLmRldGFjaCA9IGZ1bmN0aW9uICgpIHtcbiAgICBUcmVlVmlldy5fX3N1cGVyX18uZGV0YWNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cbiAgICBpZiAodGhpcy5wYW5lbCkge1xuICAgICAgdGhpcy5wYW5lbC5kZXN0cm95KCk7XG4gICAgICB0aGlzLnBhbmVsID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5pc1Zpc2libGUoKSkge1xuICAgICAgdGhpcy5kZXRhY2goKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hdHRhY2goKTtcbiAgICB9XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnNob3dPZmZsaW5lID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubGlzdC5oaWRlKCk7XG4gICAgdGhpcy5xdWV1ZS5oaWRlKCk7XG4gICAgdGhpcy5vZmZsaW5lLmNzcygnZGlzcGxheScsICdmbGV4Jyk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnNob3dPbmxpbmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5saXN0LnNob3coKTtcbiAgICB0aGlzLnF1ZXVlLnNob3coKTtcbiAgICB0aGlzLm9mZmxpbmUuaGlkZSgpO1xuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKHBhdGgpIHtcbiAgICBjb25zdCB2aWV3ID0gJChgLnJlbW90ZS1mdHAtdmlldyBbZGF0YS1wYXRoPVwiJHtwYXRofVwiXWApLm1hcChmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCB2ID0gJCh0aGlzKS52aWV3KCk7XG4gICAgICByZXR1cm4gdiB8fCBudWxsO1xuICAgIH0pLmdldCgwKTtcblxuICAgIHJldHVybiB2aWV3O1xuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5nZXRTZWxlY3RlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCB2aWV3cyA9ICQoJy5yZW1vdGUtZnRwLXZpZXcgLnNlbGVjdGVkJykubWFwKGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IHYgPSAkKHRoaXMpLnZpZXcoKTtcbiAgICAgIHJldHVybiB2IHx8IG51bGw7XG4gICAgfSkuZ2V0KCk7XG5cbiAgICByZXR1cm4gdmlld3M7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZVZlcnRpY2FsU3RhcnRlZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdGhpcy5yZXNpemVIZWlnaHRTdGFydCA9IHRoaXMucXVldWUuaGVpZ2h0KCk7XG4gICAgdGhpcy5yZXNpemVNb3VzZVN0YXJ0ID0gZS5wYWdlWTtcbiAgICAkKGRvY3VtZW50KS5vbignbW91c2Vtb3ZlJywgdGhpcy5yZXNpemVWZXJ0aWNhbFZpZXcuYmluZCh0aGlzKSk7XG4gICAgJChkb2N1bWVudCkub24oJ21vdXNldXAnLCB0aGlzLnJlc2l6ZVZlcnRpY2FsU3RvcHBlZCk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZVZlcnRpY2FsU3RvcHBlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBkZWxldGUgdGhpcy5yZXNpemVIZWlnaHRTdGFydDtcbiAgICBkZWxldGUgdGhpcy5yZXNpemVNb3VzZVN0YXJ0O1xuICAgICQoZG9jdW1lbnQpLm9mZignbW91c2Vtb3ZlJywgdGhpcy5yZXNpemVWZXJ0aWNhbFZpZXcpO1xuICAgICQoZG9jdW1lbnQpLm9mZignbW91c2V1cCcsIHRoaXMucmVzaXplVmVydGljYWxTdG9wcGVkKTtcbiAgfTtcblxuICBUcmVlVmlldy5wcm90b3R5cGUucmVzaXplVmVydGljYWxWaWV3ID0gZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS53aGljaCAhPT0gMSlcdFx0XHR7IHJldHVybiB0aGlzLnJlc2l6ZVZlcnRpY2FsU3RvcHBlZCgpOyB9XG5cbiAgICBsZXQgZGVsdGEgPSBlLnBhZ2VZIC0gdGhpcy5yZXNpemVNb3VzZVN0YXJ0LFxuICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoMjYsIHRoaXMucmVzaXplSGVpZ2h0U3RhcnQgLSBkZWx0YSk7XG5cbiAgICB0aGlzLnF1ZXVlLmhlaWdodChoZWlnaHQpO1xuICAgIHRoaXMuc2Nyb2xsZXIuY3NzKCdib3R0b20nLCBgJHtoZWlnaHR9cHhgKTtcbiAgfTtcblxuICBUcmVlVmlldy5wcm90b3R5cGUucmVzaXplSG9yaXpvbnRhbFN0YXJ0ZWQgPSBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIHRoaXMucmVzaXplV2lkdGhTdGFydCA9IHRoaXMud2lkdGgoKTtcbiAgICB0aGlzLnJlc2l6ZU1vdXNlU3RhcnQgPSBlLnBhZ2VYO1xuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZW1vdmUnLCB0aGlzLnJlc2l6ZUhvcml6b250YWxWaWV3LmJpbmQodGhpcykpO1xuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgdGhpcy5yZXNpemVIb3Jpem9udGFsU3RvcHBlZCk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZUhvcml6b250YWxTdG9wcGVkID0gZnVuY3Rpb24gKCkge1xuICAgIGRlbGV0ZSB0aGlzLnJlc2l6ZVdpZHRoU3RhcnQ7XG4gICAgZGVsZXRlIHRoaXMucmVzaXplTW91c2VTdGFydDtcbiAgICAkKGRvY3VtZW50KS5vZmYoJ21vdXNlbW92ZScsIHRoaXMucmVzaXplSG9yaXpvbnRhbFZpZXcpO1xuICAgICQoZG9jdW1lbnQpLm9mZignbW91c2V1cCcsIHRoaXMucmVzaXplSG9yaXpvbnRhbFN0b3BwZWQpO1xuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5yZXNpemVIb3Jpem9udGFsVmlldyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUud2hpY2ggIT09IDEpXHRcdFx0eyByZXR1cm4gdGhpcy5yZXNpemVIb3Jpem9udGFsU3RvcHBlZCgpOyB9XG5cbiAgICBsZXQgZGVsdGEgPSBlLnBhZ2VYIC0gdGhpcy5yZXNpemVNb3VzZVN0YXJ0LFxuICAgICAgd2lkdGggPSBNYXRoLm1heCg1MCwgdGhpcy5yZXNpemVXaWR0aFN0YXJ0ICsgZGVsdGEpO1xuXG4gICAgdGhpcy53aWR0aCh3aWR0aCk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlc2l6ZVRvRml0Q29udGVudCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdGhpcy53aWR0aCgxKTtcbiAgICB0aGlzLndpZHRoKHRoaXMubGlzdC5vdXRlcldpZHRoKCkpO1xuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5yZW1vdGVLZXlib2FyZE5hdmlnYXRpb24gPSBmdW5jdGlvbiAoZSkge1xuICAgIGxldCBhcnJvd3MgPSB7IGxlZnQ6IDM3LCB1cDogMzgsIHJpZ2h0OiAzOSwgZG93bjogNDAgfSxcbiAgICAgIGtleUNvZGUgPSBlLmtleUNvZGUgfHwgZS53aGljaDtcblxuICAgIHN3aXRjaCAoa2V5Q29kZSkge1xuICAgICAgY2FzZSBhcnJvd3MudXA6XG4gICAgICAgIHRoaXMucmVtb3RlS2V5Ym9hcmROYXZpZ2F0aW9uVXAoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGFycm93cy5kb3duOlxuICAgICAgICB0aGlzLnJlbW90ZUtleWJvYXJkTmF2aWdhdGlvbkRvd24oKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGFycm93cy5sZWZ0OlxuICAgICAgICB0aGlzLnJlbW90ZUtleWJvYXJkTmF2aWdhdGlvbkxlZnQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGFycm93cy5yaWdodDpcbiAgICAgICAgdGhpcy5yZW1vdGVLZXlib2FyZE5hdmlnYXRpb25SaWdodCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLnJlbW90ZUtleWJvYXJkTmF2aWdhdGlvbk1vdmVQYWdlKCk7XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlbW90ZUtleWJvYXJkTmF2aWdhdGlvblVwID0gZnVuY3Rpb24gKCkge1xuICAgIGxldCBjdXJyZW50ID0gdGhpcy5saXN0LmZpbmQoJy5zZWxlY3RlZCcpLFxuICAgICAgbmV4dCA9IGN1cnJlbnQucHJldignLmVudHJ5OnZpc2libGUnKTtcbiAgICBpZiAobmV4dC5sZW5ndGgpIHtcbiAgICAgIHdoaWxlIChuZXh0LmlzKCcuZXhwYW5kZWQnKSAmJiBuZXh0LmZpbmQoJy5lbnRyaWVzIC5lbnRyeTp2aXNpYmxlJykubGVuZ3RoKSB7XG4gICAgICAgIG5leHQgPSBuZXh0LmZpbmQoJy5lbnRyaWVzIC5lbnRyeTp2aXNpYmxlJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHQgPSBjdXJyZW50LmNsb3Nlc3QoJy5lbnRyaWVzJykuY2xvc2VzdCgnLmVudHJ5OnZpc2libGUnKTtcbiAgICB9XG4gICAgaWYgKG5leHQubGVuZ3RoKSB7XG4gICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgbmV4dC5sYXN0KCkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgfVxuICB9O1xuXG4gIFRyZWVWaWV3LnByb3RvdHlwZS5yZW1vdGVLZXlib2FyZE5hdmlnYXRpb25Eb3duID0gZnVuY3Rpb24gKCkge1xuICAgIGxldCBjdXJyZW50ID0gdGhpcy5saXN0LmZpbmQoJy5zZWxlY3RlZCcpLFxuICAgICAgbmV4dCA9IGN1cnJlbnQuZmluZCgnLmVudHJpZXMgLmVudHJ5OnZpc2libGUnKTtcbiAgICBpZiAoIW5leHQubGVuZ3RoKSB7XG4gICAgICB0bXAgPSBjdXJyZW50O1xuICAgICAgZG8ge1xuICAgICAgICBuZXh0ID0gdG1wLm5leHQoJy5lbnRyeTp2aXNpYmxlJyk7XG4gICAgICAgIGlmICghbmV4dC5sZW5ndGgpIHtcbiAgICAgICAgICB0bXAgPSB0bXAuY2xvc2VzdCgnLmVudHJpZXMnKS5jbG9zZXN0KCcuZW50cnk6dmlzaWJsZScpO1xuICAgICAgICB9XG4gICAgICB9IHdoaWxlICghbmV4dC5sZW5ndGggJiYgIXRtcC5pcygnLnByb2plY3Qtcm9vdCcpKTtcbiAgICB9XG4gICAgaWYgKG5leHQubGVuZ3RoKSB7XG4gICAgICBjdXJyZW50LnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgbmV4dC5maXJzdCgpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgIH1cbiAgfTtcblxuICBUcmVlVmlldy5wcm90b3R5cGUucmVtb3RlS2V5Ym9hcmROYXZpZ2F0aW9uTGVmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5saXN0LmZpbmQoJy5zZWxlY3RlZCcpO1xuICAgIGlmICghY3VycmVudC5pcygnLmRpcmVjdG9yeScpKSB7XG4gICAgICBuZXh0ID0gY3VycmVudC5jbG9zZXN0KCcuZGlyZWN0b3J5Jyk7XG4gICAgICBuZXh0LnZpZXcoKS5jb2xsYXBzZSgpO1xuICAgICAgY3VycmVudC5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgIG5leHQuZmlyc3QoKS5hZGRDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3VycmVudC52aWV3KCkuY29sbGFwc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgVHJlZVZpZXcucHJvdG90eXBlLnJlbW90ZUtleWJvYXJkTmF2aWdhdGlvblJpZ2h0ID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmxpc3QuZmluZCgnLnNlbGVjdGVkJyk7XG4gICAgaWYgKGN1cnJlbnQuaXMoJy5kaXJlY3RvcnknKSkge1xuICAgICAgY29uc3QgdmlldyA9IGN1cnJlbnQudmlldygpO1xuICAgICAgdmlldy5vcGVuKCk7XG4gICAgICB2aWV3LmV4cGFuZCgpO1xuICAgIH1cbiAgfTtcblxuICBUcmVlVmlldy5wcm90b3R5cGUucmVtb3RlS2V5Ym9hcmROYXZpZ2F0aW9uTW92ZVBhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgY3VycmVudCA9IHRoaXMubGlzdC5maW5kKCcuc2VsZWN0ZWQnKTtcbiAgICBpZiAoY3VycmVudC5sZW5ndGgpIHtcbiAgICAgIGxldCBzY3JvbGxlclRvcCA9IHRoaXMuc2Nyb2xsZXIuc2Nyb2xsVG9wKCksXG4gICAgICAgIHNlbGVjdGVkVG9wID0gY3VycmVudC5wb3NpdGlvbigpLnRvcDtcbiAgICAgIGlmIChzZWxlY3RlZFRvcCA8IHNjcm9sbGVyVG9wIC0gMTApIHtcbiAgICAgICAgdGhpcy5zY3JvbGxlci5wYWdlVXAoKTtcbiAgICAgIH0gZWxzZSBpZiAoc2VsZWN0ZWRUb3AgPiBzY3JvbGxlclRvcCArIHRoaXMuc2Nyb2xsZXIuaGVpZ2h0KCkgLSAxMCkge1xuICAgICAgICB0aGlzLnNjcm9sbGVyLnBhZ2VEb3duKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBUcmVlVmlldztcbn0oU2Nyb2xsVmlldykpO1xuIl19